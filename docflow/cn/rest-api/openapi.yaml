openapi: 3.0.0
info:
  title: DocFlow API
  description: DocFlow REST API，提供文件上传和获取文件处理结果能力
  version: 2.0.0
servers:
  - url: https://docflow.textin.com

x-codeSamples: custom

paths:
  /api/app-api/sip/platform/v2/file/upload:
    post:
      summary: 上传文件
      description: ""
      operationId: uploadFile
      parameters:
        - $ref: '#/components/parameters/WorkspaceId'
        - $ref: '#/components/parameters/Category'
        - $ref: '#/components/parameters/BatchNumber'
        - $ref: '#/components/parameters/AutoVerifyVat'
        - $ref: '#/components/parameters/SplitFlag'
        - $ref: '#/components/parameters/CropFlag'
        - $ref: '#/components/parameters/TargetProcess'
        - $ref: '#/components/parameters/ParserRemoveWatermark'
        - $ref: '#/components/parameters/ParserCropDewarp'
        - $ref: '#/components/parameters/ParserApplyMerge'
        - $ref: '#/components/parameters/ParserFormulaLevel'
        - $ref: '#/components/parameters/ParserTableTextSplitMode'
      requestBody:
        $ref: '#/components/requestBodies/FileUploadRequestBody'
      responses:
        '200':
          description: 文件上传成功
          content:
            application/json:
              schema:
                allOf:
                - $ref: '#/components/schemas/CodeMessage'
                - type: object
                  properties:
                    result:
                      type: object
                      properties:
                        batch_number:
                          type: string
                          description: 批次编号
                          example: 202412190001
                        files:
                          type: array   
                          items:
                            type: object
                            properties:
                              id:
                                type: string
                                description: 文件ID
                                example: 202412190001
                              task_id:
                                type: string
                                description: 任务ID
                                example: 1981692246135111680
                              name:
                                type: string
                                description: 文件名
                                example: invoice.pdf
                              format:
                                type: string
                                description: 文件格式
                                example: pdf
                            required:
                            - id
                            - name
                            - format
                      required:
                      - batch_number
                      - files

  /api/app-api/sip/platform/v2/file/upload/sync:
    post:
      summary: 同步上传文件
      description: 同步上传文件并等待处理完成，返回处理结果
      operationId: uploadFileSync
      parameters:
        - $ref: '#/components/parameters/WorkspaceId'
        - $ref: '#/components/parameters/Category'
        - $ref: '#/components/parameters/BatchNumber'
        - $ref: '#/components/parameters/AutoVerifyVat'
        - $ref: '#/components/parameters/SplitFlag'
        - $ref: '#/components/parameters/CropFlag'
        - $ref: '#/components/parameters/TargetProcess'
        - $ref: '#/components/parameters/ParserRemoveWatermark'
        - $ref: '#/components/parameters/ParserCropDewarp'
        - $ref: '#/components/parameters/ParserApplyMerge'
        - $ref: '#/components/parameters/ParserFormulaLevel'
        - $ref: '#/components/parameters/ParserTableTextSplitMode'
      requestBody:
        $ref: '#/components/requestBodies/FileUploadRequestBody'
      responses:
        '200':
          description: 文件上传并处理成功
          content:
            application/json:
              schema:
                allOf:
                - $ref: '#/components/schemas/CodeMessage'
                - $ref: '#/components/schemas/TaskProcessResult'

  /api/app-api/sip/platform/v2/file/fetch:
    get:
      summary: 获取文件处理结果列表
      description: ""
      operationId: getFiles
      parameters:
        - name: page
          in: query
          description: 页码，默认1
          required: false
          schema:
            type: integer
            default: 1
        - name: page_size
          in: query
          description: 每页数量，默认1000
          required: false
          schema:
            type: integer
            default: 1000
        - name: workspace_id
          in: query
          description: 空间ID
          required: true
          schema:
            type: string
        - name: batch_number
          in: query
          description: 批次编号
          required: false
          schema:
            type: string
        - name: file_id
          in: query
          description: 文件ID
          required: false
          schema:
            type: string
        - name: category
          in: query
          description: 文件类别
          required: false
          schema:
            type: string
        - name: recognition_status
          in: query
          required: false
          schema:
            $ref: '#/components/schemas/RecognitionStatus'
        - name: verification_status
          in: query
          description: "文件核对状态 0: 待核对 2: 已确认 3: 已拒绝 4: 已删除 5: 推迟处理"
          required: false
          schema:
            $ref: '#/components/schemas/VerificationStatus'
        - name: start_time
          in: query
          description: 以更新时间搜索的开始时间, RFC3339格式(YYYY-MM-DDTHH:MM:SSZ)
          required: false
          schema:
            type: string
            format: date-time
            example: 2024-01-01T00:00:00Z
        - name: end_time
          in: query
          description: 以更新时间搜索的结束时间, RFC3339格式(YYYY-MM-DDTHH:MM:SSZ)
          required: false
          schema:
            type: string
            format: date-time
            example: 2024-01-01T10:00:00Z
        - name: with_document
          in: query
          description: 是否返回文档的全部文字识别结果
          required: false
          schema:
            type: boolean
            default: false
      responses:
        '200':
          description: 成功获取文件列表
          content:
            application/json:
              schema:
                allOf:
                - $ref: '#/components/schemas/CodeMessage'
                - $ref: '#/components/schemas/TaskProcessResult'
  /api/app-api/sip/platform/v2/file/delete:
    post:
      summary: 删除任务
      description: 按条件删除文件，满足任一条件即可删除。
      operationId: deleteFile
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                workspace_id:
                  type: string
                  description: 空间ID
                  example: 1234567890
                batch_number:
                  type: array
                  items:
                    type: string
                  description: 批次编号列表
                  example: ["202412190001", "202412190002"]
                task_id:
                  type: array
                  items:
                    type: string
                  description: 任务ID列表
                  example: ["1978297791713619968", "1978297791713619969"]
                file_id:
                  type: array
                  items:
                    type: string
                  description: 文件ID列表
                  example: ["1978297792124661760", "1978297792124661761"]
                start_time:
                  type: integer
                  description: 开始时间（epoch时间戳，单位：秒）
                  example: 1760523600
                end_time:
                  type: integer
                  description: 结束时间(epoch时间戳，单位：秒)
                  example: 1760523600
              required:
                - workspace_id
      responses:
        '200':
          description: 成功删除任务
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/CodeMessage'
                  - type: object
                    properties:
                      result:
                        type: object
                        properties:
                          deleted_count:
                            type: integer
                            description: 删除的文件数量
                            example: 1
  /api/app-api/sip/platform/v2/file/update:
    post:
      summary: 更新文件处理结果
      description: 更新文件处理结果。通常用于人工审核校对后，上传修改后的key-value，覆盖自动识别的结果。
      operationId: updateFile
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: array
              items:
                type: object
                properties:
                  workspace_id:
                    type: string
                    description: 空间ID
                    example: 1234567890
                  file_id:
                    type: string
                    description: 文件ID
                    example: 202412190001
                  data:
                    description: |
                      全量更新字段。  
                      注意，即使只更新部分字段，也必须包含所有字段。  
                      如果传入的字段较原字段多，则多出的字段会被添加。  
                      如果传入的字段较原字段少，则缺少的字段会被删除。  
                      如果传入的字段值较原字段值有变化，则字段值会被更新。  
                      如果传入的字段与原字段完全相同，则字段会被保留。
                    type: object
                    properties:
                      fields:
                        type: array
                        items:
                          $ref: '#/components/schemas/KeyValue'
                        example:
                        - key: 发票代码
                          value: "3100231130"
                          position:
                          - page: 0
                            vertices: [0, 0, 100, 0, 100, 100, 0, 100]
                        - key: 发票号码
                          value: "28737000"
                          position:
                          - page: 0
                            vertices: [0, 0, 100, 0, 100, 100, 0, 100]
                      items:
                        type: array
                        items:
                          type: array
                          items:
                            $ref: '#/components/schemas/KeyValue'
                        example:
                        - - key: 货物劳务名称
                            value: ＊电子计算机＊微型计算机主机
                            position:
                            - page: 0
                              vertices: [0, 0, 100, 0, 100, 100, 0, 100]
                          - key: 规格型号
                            value: DMS-SC68
                            position:
                            - page: 0
                              vertices: [0, 0, 100, 0, 100, 100, 0, 100]
                        - - key: 货物劳务名称
                            value: ＊机械计算机＊巨型计算机主机
                            position:
                            - page: 0
                              vertices: [0, 0, 100, 0, 100, 100, 0, 100]
                          - key: 规格型号
                            value: AN/FSQ-7
                            position:
                            - page: 0
                              vertices: [0, 0, 100, 0, 100, 100, 0, 100]
                required:
                - workspace_id
                - file_id
                - data
      responses:
        '200':
          description: 成功更新文件处理结果
          content:
            application/json:
              schema:
                allOf:
                - $ref: '#/components/schemas/CodeMessage'
                - type: object
                  properties:
                    result:
                      type: object
                      properties:
                        files:
                          description: 更新后的文件列表
                          type: array
                          items:
                            type: object
                            properties:
                              workspace_id:
                                type: string
                                description: 空间ID
                                example: 1234567890
                              id:
                                type: string
                                description: 文件ID
                                example: 202412190001
      x-codeSamples:
        - lang: 'bash'
          label: cURL
          source: | 
            curl -X POST \
            -H 'x-ti-app-id: 1234567890' \
            -H 'x-ti-secret-code: 1234567890' \
            -d '[{"workspace_id": "1234567890", "file_id": "202412190001", "data": {"fields": [{"key": "发票代码", "value": "3100231130"}]}}]' \
            'https://docflow.textin.com/api/app-api/sip/platform/v2/file/update'
  /api/app-api/sip/platform/v2/file/amend_category:
    post:
      summary: 修改文件类别
      description: |
        - 对于普通任务，修改普通任务文件类别
        - 对于文档拆分任务，修改拆分后的文件类型和页码
        - 对于多图切分任务，修改切分后的文件类型
      operationId: amendCategory
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                workspace_id:
                  type: string
                  description: 空间ID
                  example: 1234567890
                task_id:
                  type: string
                  description: 任务ID
                  example: 1234567890
                category:
                  type: string
                  description: |
                    新文件类别。
                    只有当任务类型为普通任务时，才支持更新文件类别。
                  example: 电子发票（普通发票）
                split_tasks:
                  description: 文件拆分任务列表
                  type: array
                  items:
                    type: object
                    properties:
                      category:
                        type: string
                        description: 子任务文件类别
                        example: 电子发票（普通发票）
                      pages:
                        type: array
                        items:
                          type: integer
                          description: 子文件页码，从0开始计数
                        example: [0, 1]
                crop_tasks:
                  description: 多图切分任务列表
                  type: array
                  items:
                    type: object
                    properties:
                      crop_child_task_id:
                        type: string
                        description: 多图切分子任务ID
                        example: 1234567890
                      category:
                        type: string
                        description: 子任务文件类别
                        example: 电子发票（普通发票）
              required:
                - workspace_id
                - task_id
      responses:
        '200':
          description: 成功更新文件类别
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/CodeMessage'
  /api/app-api/sip/platform/v2/file/retry:
    post:
      summary: 重新处理文件
      description: 重新处理文件。
      operationId: retryFile
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                workspace_id:
                  type: string
                  description: 空间ID
                  example: 1234567890
                task_id:
                  type: string
                  description: 任务ID
                  example: 1234567890
                parser_params:
                  $ref: '#/components/schemas/DocumentParserParam'
              required:
                - workspace_id
                - task_id
      responses:
        '200':
          description: 成功重新处理文件
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/CodeMessage'
  /api/app-api/sip/platform/v2/file/extract_fields:
    post:
      summary: 抽取特定字段
      description: |
        针对已经完成抽取的任务，为该任务抽取额外的字段，或重新抽取个别已有的字段。  
        返回所有字段的完整抽取结果。返回结构同`/api/app-api/sip/platform/v2/file/fetch`。
      operationId: extractFields
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                workspace_id:
                  type: string
                  description: 空间ID
                  example: 1234567890
                task_id:
                  type: string
                  description: 任务ID
                  example: 1234567890
                fields:
                  type: array
                  items:
                    $ref: '#/components/schemas/ExtractFieldReqVO'
                tables:
                  type: array
                  items:
                    type: object
                    properties:
                      name:
                        type: string
                        description: 表格名称
                        example: Table1
                      fields:
                        type: array
                        items:
                          $ref: '#/components/schemas/ExtractFieldReqVO'
              required:
                - workspace_id
                - task_id
      responses:
        '200':
          description: 成功提取字段
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/CodeMessage'
                  - $ref: '#/components/schemas/TaskProcessResult'
components:
  parameters:
    WorkspaceId:
      name: workspace_id
      in: query
      description: 空间ID
      required: true
      schema:
        type: string
        example: 1234567890
    Category:
      name: category
      in: query
      description: 文件类别
      required: false
      schema:
        type: string
        example: invoice
    BatchNumber:
      name: batch_number
      in: query
      description: |
        批次编号。  
        可以用同一个批次编号上传多次，后续可以用批次编号获取该批次多个文件处理结果。  
        如果值为空，则系统自动生成最长20位字符串
      required: false
      schema:
        type: string
        example: 202412190001
    AutoVerifyVat:
      name: auto_verify_vat
      in: query
      description: 是否自动进行发票验真
      required: false
      schema:
        type: boolean
        default: false
    SplitFlag:
      name: split_flag
      in: query
      description: 是否进行文件拆分
      required: false
      schema:
        type: boolean
        default: false
    CropFlag:
      name: crop_flag
      in: query
      description: 是否进行多图切分
      required: false
      schema:
        type: boolean
        default: false
    TargetProcess:
      name: target_process
      in: query
      description: |
        目标处理类型。  
        可选值：  
        - `classify`: 分类  
        - `extract`: 抽取  
      required: false
      schema:
        type: string
        enum:
          - classify
          - extract
        example: classify
    ParserRemoveWatermark:
      name: parser_remove_watermark
      in: query
      description: 是否去水印（0:不去水印、1:去水印）
      required: false
      schema:
        type: integer
        default: 0
    ParserCropDewarp:
      name: parser_crop_dewarp
      in: query
      description: 是否进行切边矫正（0:不进行切边矫正、1:进行切边矫正）
      required: false
      schema:
        type: integer
        default: 0
    ParserApplyMerge:
      name: parser_apply_merge
      in: query
      description: 是否进行跨页段落表格合并（0:不合并、1:合并）
      required: false
      schema:
        type: integer
        default: 1
    ParserFormulaLevel:
      name: parser_formula_level
      in: query
      description: 公式识别等级(0 行间公式和行内公式都识别、1 仅识别行间公式，行内公式不识别、2 不识别公式)
      required: false
      schema:
        type: integer
        default: 0
    ParserTableTextSplitMode:
      name: parser_table_text_split_mode
      in: query
      description: 表格线是否分割ocr文本（0:不切割、1:切割）
      required: false
      schema:
        type: integer
        default: 0

  requestBodies:
    FileUploadRequestBody:
      description: 文件上传请求体
      required: true
      content:
        multipart/form-data:
          schema:
            type: object
            properties:
              file:
                type: string
                format: binary
        application/json:
          schema:
            type: object
            properties:
              urls:
                description: |
                  文件URL列表
                  一次最多支持上传10个文件URL，每个文件最大不超过50MB
                type: array
                items:
                  type: string
                  description: 文件URL
                  example: https://example.com/file.pdf
                  pattern: ^https?://.*$
                maxItems: 10
            required:
            - urls
  schemas: 
    RecognitionStatus:
      type: integer
      description: |
        文件识别状态: 
        - 0: 待识别
        - 1: 识别成功
        - 2: 识别失败
        - 3: 分类中
        - 4: 抽取中
        - 5: 准备中
        - 6: 文件拆分中
        - 7: 切图中
        - 10: 分类完成(当upload接口的target_process为classify时才有此状态)
        - 20: 解析中
      enum:
      - 0
      - 1
      - 2
      - 3
      - 4
      - 5
      - 6
      - 7
      - 10
      - 20
    VerificationStatus:
      type: integer
      description: "文件核对状态 0: 待核对 2: 已确认 3: 已拒绝 4: 已删除 5: 推迟处理"
      enum:
        - 0
        - 2
        - 3
        - 4
        - 5
    CodeMessage:
      type: object
      properties:
        code:
          type: integer
          description: 状态码
          example: 200
        msg:
          type: string
          description: 状态描述
      required:
      - code
      - msg
    KeyValue:
      type: object
      properties:
        key:
          type: string
          description: 字段名
        value:
          type: string
          description: 字段值
        position:
          $ref: "#/components/schemas/KeyValuePosition"
    FieldRespKeyValue:
      type: object
      properties:
        key:
          type: string
          description: 字段名
        identifier:
          type: string
          description: 导出字段名
        value:
          type: string
          description: 字段值
        position:
          $ref: "#/components/schemas/KeyValuePosition"
    StampValue:
      type: object
      properties:
        angel:
          type: integer
          description: 角度
        page:
          type: integer
          description: 页码
        text:
          type: string
          description: 印章文本内容
        type:
          type: string
          description: 印章类型
        color:
          type: string
          description: 印章颜色
        shape:
          type: string
          description: 印章形状
        position:
          type: array
          description: 位置信息
          items:
            type: integer
            example: 1
    HandWritingValue:
      type: object
      properties:
        angel:
          type: integer
          description: 角度
        page:
          type: integer
          description: 页码
        text:
          type: string
          description: 印章文本内容
        position:
          $ref: "#/components/schemas/KeyValuePosition"
    KeyValuePosition:
      description: 字段值的位置。字段值可能跨页或跨行，因此用数组展示。
      type: array
      items:
        type: object
        properties:
          page:
            type: integer
            description: 字段所在页。是`pages`数组的索引
          vertices:
            type: array
            description: 字段值的外接四边形坐标。图像以左上为原点，数组值为 [左上角x, 左上角y, 右上角x, 右上角y, 右下角x, 右下角y, 左下角x, 左下角y]
            items:
              type: integer
            minItems: 8
            maxItems: 8
    ExtractFieldReqVO:
      type: object
      properties:
        key:
          type: string
          description: 字段名称
          example: 发票代码
        prompt:
          type: string
          description: 字段提示
          example: 只保留年的部分
    TaskProcessResult:
      type: object
      properties:
        result:
          type: object
          properties:
            total:
              type: integer
              description: 文件总数
              example: 100
            page:
              type: integer
              description: 当前页码
              example: 1
            page_size:
              type: integer
              description: 每页数量 
              example: 20
            files:
              type: array
              items:
                type: object
                properties:
                  id:
                    type: string
                    description: 文件ID
                    example: 202412190001
                  task_id:
                    type: string
                    description: 任务ID
                    example: 202412190001
                  task_type:
                    $ref: '#/components/schemas/TaskType'
                  batch_number:
                    type: string
                    description: 批次编号
                    example: 202412190001
                  name:
                    type: string
                    description: 文件名
                    example: invoice.pdf
                  format:
                    type: string
                    description: 文件格式
                  recognition_status: 
                    $ref: '#/components/schemas/RecognitionStatus'
                  failure_causes:
                    type: string
                    description: |
                      任务失败原因。  
                      当recognition_status为2时，有此字段。
                  verification_status:
                    $ref: '#/components/schemas/VerificationStatus'
                  category:
                    type: string
                    description: 文件类别
                    example: invoice
                  pages:
                    $ref: '#/components/schemas/PagesInfo'
                  data:
                    type: object
                    description: 处理结果
                    properties:
                      fields:
                        description: 字段列表
                        type: array
                        items:
                          $ref: '#/components/schemas/FieldRespKeyValue'
                        example:
                        - key: 发票代码
                          identifier: 发票代码标识
                          value: "3100231130"
                          position:
                          - page: 0
                            vertices: [0, 0, 100, 0, 100, 100, 0, 100]
                        - key: 发票号码
                          value: "28737000"
                          identifier: 发票号码标识
                          position:
                          - page: 0
                            vertices: [0, 0, 100, 0, 100, 100, 0, 100]
                      items:
                        description: 表格数据列表
                        type: array
                        items:
                          type: array
                          items:
                            $ref: '#/components/schemas/KeyValue'
                        example:
                        - - key: 货物劳务名称
                            value: ＊电子计算机＊微型计算机主机
                            position:
                            - page: 0
                              vertices: [0, 0, 100, 0, 100, 100, 0, 100]
                          - key: 规格型号
                            value: DMS-SC68
                            position:
                            - page: 0
                              vertices: [0, 0, 100, 0, 100, 100, 0, 100]
                        - - key: 货物劳务名称
                            value: ＊机械计算机＊巨型计算机主机
                            position:
                            - page: 0
                              vertices: [0, 0, 100, 0, 100, 100, 0, 100]
                          - key: 规格型号
                            value: AN/FSQ-7
                            position:
                            - page: 0
                              vertices: [0, 0, 100, 0, 100, 100, 0, 100]
                      tables:
                        description: 全部表格数据列表（含系统表格和手动配置表格）
                        type: array
                        items:
                          type: object
                          properties:
                            tableName:
                              description: 表格名称
                              type: string
                              example: table1
                            tableType:
                              description: 表格类型， 0， 系统配置， 1 手动添加。
                              type: string
                              example: 0
                            items:
                              type: array
                              items:
                                type: array
                                items:
                                  $ref: '#/components/schemas/CommonFieldDetailRespVO'
                      stamps:
                        description: 印章信息
                        type: array
                        items:
                          $ref: '#/components/schemas/StampValue'
                        example:
                          - angel: 0
                            page: 0
                            text: 全国统一发票监制章
                            type: 其他
                            color: 红色
                            shape: 椭圆章
                            position: [ 0, 0, 100, 0, 100, 100, 0, 100 ]
                          - angel: 0
                            page: 0
                            text: 税务局章
                            type: 其他
                            color: 红色
                            shape: 椭圆章
                            position: [ 0, 0, 100, 0, 100, 100, 0, 100 ]
                      handwritings:
                        description: 手写体信息
                        type: array
                        items:
                          $ref: '#/components/schemas/HandWritingValue'
                        example:
                          - angel: 0
                            page: 0
                            text: 3月1日
                            position:
                              - page: 0
                                vertices: [ 0, 0, 100, 0, 100, 100, 0, 100 ]
                          - angel: 0
                            page: 0
                            text: 张三
                            position:
                              - page: 0
                                vertices: [ 0, 0, 100, 0, 100, 100, 0, 100 ]
                      invoiceVerifyResult:
                        description: 发票验真结果
                        type: object
                        properties:
                          invoiceVerifyStatus:
                            type: integer
                            description: 发票验真是否成功(0:否,1:是, null:未验真)
                            example: 0
                          invoiceVerifyErrorCode:
                            type: integer
                            description: 发票验真错误码
                            example: 0
                          invoiceVerifyCanRetry:
                            type: integer
                            description: 发票验真是否可以重试/发起(0:否,1:是)
                            example: 0
                          invoiceVerifyFailMsg:
                            type: string
                            description: 发票验真失败原因
                            example: 超过当天次数上限
                  document:
                    $ref: '#/components/schemas/Document'
                  child_files:
                    description: 子任务信息
                    type: array
                    items:
                      $ref: '#/components/schemas/SubFileDetailInfo'
                  duration_ms:
                    type: integer
                    description: |
                      任务处理时间，单位：毫秒
                      计算的是从任务开始至完成(成功或失败)的时间，不包括排队等待时间。
                    example: 10000
                required:
                  - id
                  - name
                  - format
                  - recognition_status
                  - verification_status
                  - category
    Document:
      type: object
      properties:
        pages:
          type: array
          items:
            type: object
            properties:
              angle:
                type: integer
                description: 页面的旋转角度
              width:
                type: integer
                description: 页面的宽度
              height:
                type: integer
                description: 页面的高度
              lines:
                description: 页面的文本行数组
                type: array
                items:
                  type: object
                  properties:
                    text:
                      type: string
                      description: 行文本
                    position:
                      type: array
                      items:
                        type: integer
                        minItems: 8
                        maxItems: 8
                    charPositions:
                      type: array
                      items:
                        type: array
                        items:
                          type: integer
                          minItems: 8
                          maxItems: 8
    TaskCropResult:
      type: object
      properties:
        page:
          type: integer
          description: 所属原文件的页索引，0代表源文件的第一页
        imageAngle:
          type: string
          description: 切分图片的角度信息
    CommonFieldDetailRespVO:
      type: object
      properties:
        key:
          type: string
          description: 字段key
        identifier:
          type: string
          description: 导出字段名
        value:
          type: string
          description: 字段值
        textInLines:
          deprecated: true
          type: array
          description: |
            **已废弃**，请使用position字段替代
            字段坐标
          items:
            $ref: '#/components/schemas/TextInLines'
        position:
          $ref: "#/components/schemas/KeyValuePosition"
        index:
          type: integer
          description: 索引
    SubFileDetailInfo:
      type: object
      properties:
        id:
          type: string
          description: 文件ID
          example: 202412190001
        task_id:
          type: string
          description: 任务ID
          example: 202412190001
        task_type:
          $ref: '#/components/schemas/TaskType'
        parent_task_id:
          type: string
          description: 父任务ID（不为0时有意义）
          example: 202412190001
        batch_number:
          type: string
          description: 批次编号
          example: 202412190001
        name:
          type: string
          description: 文件名
          example: invoice.pdf
        format:
          type: string
          description: 文件格式
        recognition_status:
          $ref: '#/components/schemas/RecognitionStatus'
        verification_status:
          $ref: '#/components/schemas/VerificationStatus'
        category:
          type: string
          description: 文件类别
          example: invoice
        pages:
          $ref: '#/components/schemas/PagesInfo'
        data:
          type: object
          description: 处理结果
          properties:
            fields:
              description: 字段列表
              type: array
              items:
                $ref: '#/components/schemas/FieldRespKeyValue'
              example:
                - key: 发票代码
                  identifier: 发票代码标识
                  value: "3100231130"
                  position:
                    - page: 0
                      vertices: [ 0, 0, 100, 0, 100, 100, 0, 100 ]
                - key: 发票号码
                  identifier: 发票号码标识
                  value: "28737000"
                  position:
                    - page: 0
                      vertices: [ 0, 0, 100, 0, 100, 100, 0, 100 ]
            items:
              description: 表格数据列表
              type: array
              items:
                type: array
                items:
                  $ref: '#/components/schemas/KeyValue'
              example:
                - - key: 货物劳务名称
                    value: ＊电子计算机＊微型计算机主机
                    position:
                      - page: 0
                        vertices: [ 0, 0, 100, 0, 100, 100, 0, 100 ]
                  - key: 规格型号
                    value: DMS-SC68
                    position:
                      - page: 0
                        vertices: [ 0, 0, 100, 0, 100, 100, 0, 100 ]
                - - key: 货物劳务名称
                    value: ＊机械计算机＊巨型计算机主机
                    position:
                      - page: 0
                        vertices: [ 0, 0, 100, 0, 100, 100, 0, 100 ]
                  - key: 规格型号
                    value: AN/FSQ-7
                    position:
                      - page: 0
                        vertices: [ 0, 0, 100, 0, 100, 100, 0, 100 ]
            tables:
              description: 全部表格数据列表（含系统表格和手动配置表格）
              type: array
              items:
                type: object
                properties:
                  tableName:
                    description: 表格名称
                    type: string
                    example: table1
                  tableType:
                    description: 表格类型， 0， 系统配置， 1 手动添加。
                    type: string
                    example: 0
                  items:
                    type: array
                    items:
                      type: array
                      items:
                        $ref: '#/components/schemas/CommonFieldDetailRespVO'
            stamps:
              description: 印章信息
              type: array
              items:
                $ref: '#/components/schemas/StampValue'
              example:
                - angel: 0
                  page: 0
                  text: 全国统一发票监制章
                  type: 其他
                  color: 红色
                  shape: 椭圆章
                  position: [ 0, 0, 100, 0, 100, 100, 0, 100 ]
                - angel: 0
                  page: 0
                  text: 税务局章
                  type: 其他
                  color: 红色
                  shape: 椭圆章
                  position: [ 0, 0, 100, 0, 100, 100, 0, 100 ]
            handwritings:
              description: 手写体信息
              type: array
              items:
                $ref: '#/components/schemas/HandWritingValue'
              example:
                - angel: 0
                  page: 0
                  text: 3月1日
                  position:
                    - page: 0
                      vertices: [ 0, 0, 100, 0, 100, 100, 0, 100 ]
                - angel: 0
                  page: 0
                  text: 张三
                  position:
                    - page: 0
                      vertices: [ 0, 0, 100, 0, 100, 100, 0, 100 ]
            invoiceVerifyResult:
              description: 发票验真结果
              type: object
              properties:
                invoiceVerifyStatus:
                  type: integer
                  description: 发票验真是否成功(0:否,1:是, null:未验真)
                  example: 0
                invoiceVerifyErrorCode:
                  type: integer
                  description: 发票验真错误码
                  example: 0
                invoiceVerifyCanRetry:
                  type: integer
                  description: 发票验真是否可以重试/发起(0:否,1:是)
                  example: 0
                invoiceVerifyFailMsg:
                  type: string
                  description: 发票验真失败原因
                  example: 超过当天次数上限
        document:
          $ref: '#/components/schemas/Document'
        from_parent_position_list:
          type: array
          description: 切图结果在原文件中的坐标位置
          items:
            type: integer
            description: 位置信息
            example: 1
        crop_info:
          $ref: '#/components/schemas/TaskCropResult'
    TextInLines:
      type: object
      properties:
        angle:
          type: string
          description: 角度
          example: 0
        pos:
          type: array
          description: 坐标
          items:
            type: integer
            description: 坐标
            example: 1
        page:
          type: integer
          description: 页码
          example: 1
        text:
          type: string
          description: 文本
          example: 文本内容
        char_pos:
          type: array
          description: 字符坐标
          items:
            type: array
            description: 字符坐标
            items:
              type: integer
              description: 字符坐标
              example: 1
      description: 字段坐标
    TaskType:
      type: integer
      description: |
        任务类型
        - `0`: **文件拆分子任务**：打开“文件拆分”开关的文件任务执行成功后，该文件批次任务中因文件拆分操作产生的子任务即为拆分子任务，按照文件类别下实际文件套数区分子任务
        - `1`: **普通任务**：未打开“文件拆分”和“多图切分”开关的文件任务
        - `2`: **父任务**：打开“文件拆分”或“多图切分”开关的文件任务执行后，该文件批次任务中的每份文件即为父任务
        - `3`: **切图子任务**：打开“多图切分”开关的文件任务执行成功后，该文件批次任务中因多图切分操作产生的子任务即为切分子任务，按照文件类别下实际切图结果数量区分子任务
      example: 1
    PagesInfo:
      type: array
      description: |
        文件每页用于渲染的数据。  
        配合`data.fields`中的`page`和`position`字段，可以准确画出字段在页面上的位置。
      items:
        type: object
        properties:
          page:
            type: integer
            description: 页码,从0开始
            example: 1
          angle:
            type: integer
            description: 旋转角度
            enum:
              - 0
              - 90
              - 180
              - 270
          width:
            type: integer
            description: 转正后的页宽
            example: 1024
          height:
            type: integer
            description: 转正后的页高
            example: 1024
          dpi:
            type: integer
            description: PDF转图片时的分辨率。非PDF文件该值为`0`.
            example: 144
    DocumentParserParam:
      type: object
      properties:
        formula_level:
          type: integer
          description: 公式识别等级(0 行间公式和行内公式都识别、1 仅识别行间公式，行内公式不识别、2 不识别公式)
          example: 0
        apply_merge:
          type: integer
          description: 跨页段落表格合并(0 不合并、1 合并)
          example: 1
        table_text_split_mode:
          type: integer
          description: 切分被表格线穿过的文本块(0 不切分、1 切分)
          example: 0
        crop_dewarp:
          type: integer
          description: 是否进行切边矫正(0 不进行切边矫正、1 进行切边矫正)
          example: 0
        remove_watermark:
          type: integer
          description: 是否去水印(0 不去水印、1 去水印)
          example: 0

  securitySchemes:
    ApiId: # arbitrary name for the security scheme
      type: apiKey
      in: header # can be "header", "query" or "cookie"
      name: x-ti-app-id
    SecretCode: # arbitrary name for the security scheme
      type: apiKey
      in: header # can be "header", "query" or "cookie"
      name: x-ti-secret-code

security:
  - ApiId: []
    SecretCode: []
